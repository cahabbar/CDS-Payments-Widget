/*! browser_encryption - v1.0.0 - 2018-03-19 */
(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C={},D=[].slice,E=!1,F=!1,G=!1,H=!1,I=!1,J=!1,K=!1;window.CDS=C,C.cdsProcess=function(){var a,b;return b=arguments[0],a=2<=arguments.length?D.call(arguments,1):[],C.cdsProcess.prototype[b].apply(this,a)},C.cdsProcess.cards=b=[{type:"MC",patterns:[2,5],lengthRange:[16,16]},{type:"VI",patterns:[4],lengthRange:[16,19]},{type:"JC",patterns:[3],lengthRange:[16,19]},{type:"AX",patterns:[3],lengthRange:[15,15]},{type:"DC",patterns:[3],lengthRange:[14,14]},{type:"DI",patterns:[6],lengthRange:[16,16]}],C.cdsProcess.cdsResponse=z={},C.cdsProcess.prototype.formatCardNumber=function(){return this.addEventListener("keypress",d),this.addEventListener("paste",e),this.addEventListener("keyup",k),this.addEventListener("focusout",p),this.setAttribute("maxlength","19"),this},C.cdsProcess.clientCode=function(a){if(!a)return!1;G=!0,m=a,console.time("publicKeyLoadTime"),h()},C.cdsProcess.reportEncryptionResponse=function(){var a=q();return c.fireEvent("cdsCardRespChange",[z]),a},d=function(a){console.log("restrictNumeric event triggered and handler started execution");var b;return!(!a.metaKey&&!a.ctrlKey)||(32===a.which?(a.preventDefault(),!1):0===a.which||(a.which<33||(b=String.fromCharCode(a.which),/[\d\s]/.test(b)||a.preventDefault(),!!/[\d\s]/.test(b))))},h=function(){if(console.log("This is the public key value when getPemFile is called "+C.cdsProcess.publicKey+" Its Boolean value: "+Boolean(C.cdsProcess.publicKey)+" toProcessCacheOnLoad value "+F),!C.cdsProcess.publicKey){var a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.open("POST","https://qa-tznservice.buysub.com/getkey"),a.withCredentials=!0,a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.setRequestHeader("dataType","json"),a.onload=function(){if(4===a.readyState)if(a.status>=200&&a.status<400){clearTimeout(b);var c=a.response,d=JSON.parse(c);d?(i(d.key),F?(console.timeEnd("publicKeyLoadTimeForCache"),n()):console.timeEnd("publicKeyLoadTime")):(console.error("Public key not found"),I=!0,q())}else console.log("Received Exception while loading public key"),I=!0,q()},a.onerror=function(){console.error("Exception occurred while loading public key due to connection error, so default key will be used")},a.send(encodeURI("pubcode="+m));var b=setTimeout(function(){a.abort(),console.log("Request to get public key aborted due to connection error"),i("-----BEGIN PUBLIC KEY----- MIGJAoGBANfWaaUdVnwKOn8yM/gp+PTqleHwAcxRKPDdkZbsMzcCAa069B7q5gFYS6BBSLOBjhzS4QPtmsYJtgncXZu4W1bBnhVNd5FCli8LVNbC1PkeUId65bwDGURjBdNM+ilsLIwNfSOLfNhCjv8+DkBlJKDeB/JYECzrHPWfgFkojyUnAgMBAAE= -----END PUBLIC KEY-----"),n()},3e3)}},n=function(){if(document.querySelector('input[data-cds = "ccNumber"]').value)return console.log("encryptedCcNum is either undefined or null though credit card number present"),k.call(document.querySelector('input[data-cds = "ccNumber"]')),void q()},i=function(a){a?(C.cdsProcess.publicKey=a,console.log("Base64 key: "+C.cdsProcess.publicKey)):(console.error("Public Key missing"),I=!0,q())},j=function(){if(console.time("EncryptionCardNumber"),G&&C.cdsProcess.publicKey){var a=new C.JSEncrypt;a.setPublicKey(C.cdsProcess.publicKey);var b=a.encryptToHex(document.querySelector('input[data-cds = "ccNumber"]').value);if(b)return console.timeEnd("EncryptionCardNumber"),b}else G?(console.warn("Public key missing "),I=!0,q()):(console.error("Either clientCode/allowed Card Types is not configured correctly"),I=!0,q())},e=function(a){console.log("restricPaste event triggered and handler started execution"),a.preventDefault()},k=function(){console.log("started validating card number entered"+document.querySelector('input[data-cds = "ccNumber"]').value),console.time("ValidateCardNumberEachTime"),f=null,g=null,K=!1,o();var a=this.value.length,b=this.value.charAt(0);J(b,a)?(E=u())&&v(b,a)&&(K=!0,f=j(),console.log("Card number encrypted as it is now valid & allowed card type : "+f)):E=!1,console.timeEnd("ValidateCardNumberEachTime")},a=function(a,c){for(var d=0;d<b.length;d++)for(var e=b[d].patterns,f=b[d].lengthRange,g=0;g<e.length;g++)if(a==e[g]&&c>=f[0]&&c<=f[1])return b[d].type},l=function(){var a=document.querySelector('input[data-cds = "cipher"]'),b=document.querySelector('input[data-cds = "cardType"]');a&&(a.value="",s(a)),b&&(b.value="",s(b))},y=function(){var a=document.querySelector('input[data-cds = "cipher"]');a&&(a.value="",s(a))},A=function(a,b,c){z.cardType=a,z.cipher=b,z.respCode=c},o=function(){l();var a=document.querySelector('input[data-cds = "responseCode"]');a&&(a.value="074",s(a)),A("","","074"),c.fireEvent("cdsCardValChange",[z])},J=function(b,c){return H?!!(g=a(b,c)):(G=!1,I=!0,q(),!1)},v=function(a,b){var c=C.cdsProcess.allowedCards;if(g&&c)for(var d=0;d<c.length;d++)if(c[d]==g)return!0;return!1},w=function(){var a=C.cdsProcess.allowedCards;return a&&a.constructor===Array&&a.length>0&&a.every(x)?H=!0:G=!1},x=function(a){return"string"==typeof a||a instanceof String},p=function(){console.log("reportResponseOnFocusOut event triggered and handler started execution"),q()},q=function(){var a="",b=document.querySelector('input[data-cds = "responseCode"]'),d=document.querySelector('input[data-cds = "cardType"]'),e=document.querySelector('input[data-cds = "cipher"]');return I?G?(a="099",A("","","099")):(a="075",A("","","075")):""==document.querySelector('input[data-cds = "ccNumber"]').value?(a="",A("","","")):E?E&&!K?(a="753",y(),d&&(d.value=g,s(d)),A(g,"","753")):E&&K&&f?(a="100",d&&(d.value=g,s(d)),e&&(e.value=f,s(e)),A(g,f,"100")):(a="099",l(),A("","","100")):(a="003",l(),A("","","003")),b&&(b.value=a,s(b)),c.fireEvent("cdsCardValChange",[z]),a},r=function(){this.events={},this.addEventListener=function(a,b){this.events.hasOwnProperty(a)?this.events[a].push(b):this.events[a]=[b]},this.removeEventListener=function(a,b){if(this.events.hasOwnProperty(a)){var c=this.events[a].indexOf(b);-1!=c&&this.events[a].splice(c,1)}},this.fireEvent=function(a,b){if(this.events.hasOwnProperty(a)){b&&b.length||(b=[]);for(var c=this.events[a],d=c.length,e=0;e<d;e++)c[e].apply(null,b)}}},C.cdsProcess.cdsCard=c=new r,u=function(){for(var a=document.querySelector('input[data-cds = "ccNumber"]').value,b=0,c=!1,d=a.length-1;d>=0;){var e=parseInt(a.charAt(d),10);if(isNaN(e))return!1;c&&(e*=2)>9&&(e=e%10+1),c=!c,b+=e,d--}return b%10==0},s=function(a){if("createEvent"in document){var b=document.createEvent("HTMLEvents");b.initEvent("change",!1,!0),a.dispatchEvent(b)}else a.fireEvent("onchange")},t=function(){console.time("publicKeyLoadTimeForCache"),document.querySelector('input[data-cds = "ccNumber"]').value&&(F=!0,h(),console.log("There is a card number detected could be from cache while page is loaded"))},B=function(){null!=document.querySelector('input[data-cds = "ccNumber"]')&&(C.cdsProcess.call(document.querySelector('input[data-cds = "ccNumber"]'),"formatCardNumber"),G&&w()?t():(I=!0,q()))},"complete"===document.readyState||"loading"!==document.readyState&&!document.documentElement.doScroll?B():document.addEventListener("DOMContentLoaded",B)}).call(this),function(){function a(a,b,c){null!=a&&("number"==typeof a?this.fromNumber(a,b,c):null==b&&"string"!=typeof a?this.fromString(a,256):this.fromString(a,b))}function b(){return new a(null)}function c(a,b,c,d,e,f){for(;--f>=0;){var g=b*this[a++]+c[d]+e;e=Math.floor(g/67108864),c[d++]=67108863&g}return e}function d(a,b,c,d,e,f){for(var g=32767&b,h=b>>15;--f>=0;){var i=32767&this[a],j=this[a++]>>15,k=h*i+j*g;i=g*i+((32767&k)<<15)+c[d]+(1073741823&e),e=(i>>>30)+(k>>>15)+h*j+(e>>>30),c[d++]=1073741823&i}return e}function e(a,b,c,d,e,f){for(var g=16383&b,h=b>>14;--f>=0;){var i=16383&this[a],j=this[a++]>>14,k=h*i+j*g;i=g*i+((16383&k)<<14)+c[d]+e,e=(i>>28)+(k>>14)+h*j,c[d++]=268435455&i}return e}function f(a){return V.charAt(a)}function g(a,b){var c=W[a.charCodeAt(b)];return null==c?-1:c}function h(a){for(var b=this.t-1;b>=0;--b)a[b]=this[b];a.t=this.t,a.s=this.s}function i(a){this.t=1,this.s=a<0?-1:0,a>0?this[0]=a:a<-1?this[0]=a+this.DV:this.t=0}function j(a){var c=b();return c.fromInt(a),c}function k(b,c){var d;if(16==c)d=4;else if(8==c)d=3;else if(256==c)d=8;else if(2==c)d=1;else if(32==c)d=5;else{if(4!=c)return void this.fromRadix(b,c);d=2}this.t=0,this.s=0;for(var e=b.length,f=!1,h=0;--e>=0;){var i=8==d?255&b[e]:g(b,e);i<0?"-"==b.charAt(e)&&(f=!0):(f=!1,0==h?this[this.t++]=i:h+d>this.DB?(this[this.t-1]|=(i&(1<<this.DB-h)-1)<<h,this[this.t++]=i>>this.DB-h):this[this.t-1]|=i<<h,(h+=d)>=this.DB&&(h-=this.DB))}8==d&&0!=(128&b[0])&&(this.s=-1,h>0&&(this[this.t-1]|=(1<<this.DB-h)-1<<h)),this.clamp(),f&&a.ZERO.subTo(this,this)}function l(){for(var a=this.s&this.DM;this.t>0&&this[this.t-1]==a;)--this.t}function m(a){if(this.s<0)return"-"+this.negate().toString(a);var b;if(16==a)b=4;else if(8==a)b=3;else if(2==a)b=1;else if(32==a)b=5;else{if(4!=a)return this.toRadix(a);b=2}var c,d=(1<<b)-1,e=!1,g="",h=this.t,i=this.DB-h*this.DB%b;if(h-- >0)for(i<this.DB&&(c=this[h]>>i)>0&&(e=!0,g=f(c));h>=0;)i<b?(c=(this[h]&(1<<i)-1)<<b-i,c|=this[--h]>>(i+=this.DB-b)):(c=this[h]>>(i-=b)&d,i<=0&&(i+=this.DB,--h)),c>0&&(e=!0),e&&(g+=f(c));return e?g:"0"}function n(){var c=b();return a.ZERO.subTo(this,c),c}function o(){return this.s<0?this.negate():this}function p(a){var b=this.s-a.s;if(0!=b)return b;var c=this.t;if(0!=(b=c-a.t))return this.s<0?-b:b;for(;--c>=0;)if(0!=(b=this[c]-a[c]))return b;return 0}function q(a){var b,c=1;return 0!=(b=a>>>16)&&(a=b,c+=16),0!=(b=a>>8)&&(a=b,c+=8),0!=(b=a>>4)&&(a=b,c+=4),0!=(b=a>>2)&&(a=b,c+=2),0!=(b=a>>1)&&(a=b,c+=1),c}function r(){return this.t<=0?0:this.DB*(this.t-1)+q(this[this.t-1]^this.s&this.DM)}function s(a,b){var c;for(c=this.t-1;c>=0;--c)b[c+a]=this[c];for(c=a-1;c>=0;--c)b[c]=0;b.t=this.t+a,b.s=this.s}function t(a,b){for(var c=a;c<this.t;++c)b[c-a]=this[c];b.t=Math.max(this.t-a,0),b.s=this.s}function u(a,b){var c,d=a%this.DB,e=this.DB-d,f=(1<<e)-1,g=Math.floor(a/this.DB),h=this.s<<d&this.DM;for(c=this.t-1;c>=0;--c)b[c+g+1]=this[c]>>e|h,h=(this[c]&f)<<d;for(c=g-1;c>=0;--c)b[c]=0;b[g]=h,b.t=this.t+g+1,b.s=this.s,b.clamp()}function v(a,b){b.s=this.s;var c=Math.floor(a/this.DB);if(c>=this.t)return void(b.t=0);var d=a%this.DB,e=this.DB-d,f=(1<<d)-1;b[0]=this[c]>>d;for(var g=c+1;g<this.t;++g)b[g-c-1]|=(this[g]&f)<<e,b[g-c]=this[g]>>d;d>0&&(b[this.t-c-1]|=(this.s&f)<<e),b.t=this.t-c,b.clamp()}function w(a,b){for(var c=0,d=0,e=Math.min(a.t,this.t);c<e;)d+=this[c]-a[c],b[c++]=d&this.DM,d>>=this.DB;if(a.t<this.t){for(d-=a.s;c<this.t;)d+=this[c],b[c++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=this.s;c<a.t;)d-=a[c],b[c++]=d&this.DM,d>>=this.DB;d-=a.s}b.s=d<0?-1:0,d<-1?b[c++]=this.DV+d:d>0&&(b[c++]=d),b.t=c,b.clamp()}function x(b,c){var d=this.abs(),e=b.abs(),f=d.t;for(c.t=f+e.t;--f>=0;)c[f]=0;for(f=0;f<e.t;++f)c[f+d.t]=d.am(0,e[f],c,f,0,d.t);c.s=0,c.clamp(),this.s!=b.s&&a.ZERO.subTo(c,c)}function y(a){for(var b=this.abs(),c=a.t=2*b.t;--c>=0;)a[c]=0;for(c=0;c<b.t-1;++c){var d=b.am(c,b[c],a,2*c,0,1);(a[c+b.t]+=b.am(c+1,2*b[c],a,2*c+1,d,b.t-c-1))>=b.DV&&(a[c+b.t]-=b.DV,a[c+b.t+1]=1)}a.t>0&&(a[a.t-1]+=b.am(c,b[c],a,2*c,0,1)),a.s=0,a.clamp()}function z(c,d,e){var f=c.abs();if(!(f.t<=0)){var g=this.abs();if(g.t<f.t)return null!=d&&d.fromInt(0),void(null!=e&&this.copyTo(e));null==e&&(e=b());var h=b(),i=this.s,j=c.s,k=this.DB-q(f[f.t-1]);k>0?(f.lShiftTo(k,h),g.lShiftTo(k,e)):(f.copyTo(h),g.copyTo(e));var l=h.t,m=h[l-1];if(0!=m){var n=m*(1<<this.F1)+(l>1?h[l-2]>>this.F2:0),o=this.FV/n,p=(1<<this.F1)/n,r=1<<this.F2,s=e.t,t=s-l,u=null==d?b():d;for(h.dlShiftTo(t,u),e.compareTo(u)>=0&&(e[e.t++]=1,e.subTo(u,e)),a.ONE.dlShiftTo(l,u),u.subTo(h,h);h.t<l;)h[h.t++]=0;for(;--t>=0;){var v=e[--s]==m?this.DM:Math.floor(e[s]*o+(e[s-1]+r)*p);if((e[s]+=h.am(0,v,e,t,0,l))<v)for(h.dlShiftTo(t,u),e.subTo(u,e);e[s]<--v;)e.subTo(u,e)}null!=d&&(e.drShiftTo(l,d),i!=j&&a.ZERO.subTo(d,d)),e.t=l,e.clamp(),k>0&&e.rShiftTo(k,e),i<0&&a.ZERO.subTo(e,e)}}}function A(c){var d=b();return this.abs().divRemTo(c,null,d),this.s<0&&d.compareTo(a.ZERO)>0&&c.subTo(d,d),d}function B(a){this.m=a}function C(a){return a.s<0||a.compareTo(this.m)>=0?a.mod(this.m):a}function D(a){return a}function E(a){a.divRemTo(this.m,null,a)}function F(a,b,c){a.multiplyTo(b,c),this.reduce(c)}function G(a,b){a.squareTo(b),this.reduce(b)}function H(){if(this.t<1)return 0;var a=this[0];if(0==(1&a))return 0;var b=3&a;return b=b*(2-(15&a)*b)&15,b=b*(2-(255&a)*b)&255,b=b*(2-((65535&a)*b&65535))&65535,b=b*(2-a*b%this.DV)%this.DV,b>0?this.DV-b:-b}function I(a){this.m=a,this.mp=a.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<a.DB-15)-1,this.mt2=2*a.t}function J(c){var d=b();return c.abs().dlShiftTo(this.m.t,d),d.divRemTo(this.m,null,d),c.s<0&&d.compareTo(a.ZERO)>0&&this.m.subTo(d,d),d}function K(a){var c=b();return a.copyTo(c),this.reduce(c),c}function L(a){for(;a.t<=this.mt2;)a[a.t++]=0;for(var b=0;b<this.m.t;++b){var c=32767&a[b],d=c*this.mpl+((c*this.mph+(a[b]>>15)*this.mpl&this.um)<<15)&a.DM;for(c=b+this.m.t,a[c]+=this.m.am(0,d,a,b,0,this.m.t);a[c]>=a.DV;)a[c]-=a.DV,a[++c]++}a.clamp(),a.drShiftTo(this.m.t,a),a.compareTo(this.m)>=0&&a.subTo(this.m,a)}function M(a,b){a.squareTo(b),this.reduce(b)}function N(a,b,c){a.multiplyTo(b,c),this.reduce(c)}function O(){return 0==(this.t>0?1&this[0]:this.s)}function P(c,d){if(c>4294967295||c<1)return a.ONE;var e=b(),f=b(),g=d.convert(this),h=q(c)-1;for(g.copyTo(e);--h>=0;)if(d.sqrTo(e,f),(c&1<<h)>0)d.mulTo(f,g,e);else{var i=e;e=f,f=i}return d.revert(e)}function Q(a,b){var c;return c=a<256||b.isEven()?new B(b):new I(b),this.exp(a,c)}var R,S=window.CDS;"Microsoft Internet Explorer"==navigator.appName?(a.prototype.am=d,R=30):"Netscape"!=navigator.appName?(a.prototype.am=c,R=26):(a.prototype.am=e,R=28),a.prototype.DB=R,a.prototype.DM=(1<<R)-1,a.prototype.DV=1<<R;a.prototype.FV=Math.pow(2,52),a.prototype.F1=52-R,a.prototype.F2=2*R-52;var T,U,V="0123456789abcdefghijklmnopqrstuvwxyz",W=[];for(T="0".charCodeAt(0),U=0;U<=9;++U)W[T++]=U;for(T="a".charCodeAt(0),U=10;U<36;++U)W[T++]=U;for(T="A".charCodeAt(0),U=10;U<36;++U)W[T++]=U;B.prototype.convert=C,B.prototype.revert=D,B.prototype.reduce=E,B.prototype.mulTo=F,B.prototype.sqrTo=G,I.prototype.convert=J,I.prototype.revert=K,I.prototype.reduce=L,I.prototype.mulTo=N,I.prototype.sqrTo=M,a.prototype.copyTo=h,a.prototype.fromInt=i,a.prototype.fromString=k,a.prototype.clamp=l,a.prototype.dlShiftTo=s,a.prototype.drShiftTo=t,a.prototype.lShiftTo=u,a.prototype.rShiftTo=v,a.prototype.subTo=w,a.prototype.multiplyTo=x,a.prototype.squareTo=y,a.prototype.divRemTo=z,a.prototype.invDigit=H,a.prototype.isEven=O,a.prototype.exp=P,a.prototype.toString=m,a.prototype.negate=n,a.prototype.abs=o,a.prototype.compareTo=p,a.prototype.bitLength=r,a.prototype.mod=A,a.prototype.modPowInt=Q,a.ZERO=j(0),a.ONE=j(1),S.cdsProcess.BigInteger=a}.call(this),function(a){"use strict";var b,c=window.CDS,d={};d.decode=function(a){var c;if(void 0===b){var d="0123456789ABCDEF",e=" \f\n\r\t \u2028\u2029";for(b=[],c=0;c<16;++c)b[d.charAt(c)]=c;for(d=d.toLowerCase(),c=10;c<16;++c)b[d.charAt(c)]=c;for(c=0;c<e.length;++c)b[e.charAt(c)]=-1}var f=[],g=0,h=0;for(c=0;c<a.length;++c){var i=a.charAt(c);if("="==i)break;if(-1!=(i=b[i])){if(void 0===i)throw"Illegal character at offset "+c;g|=i,++h>=2?(f[f.length]=g,g=0,h=0):g<<=4}}if(h)throw"Hex encoding incomplete: 4 bits missing";return f},c.cdsProcess.Hex=d}(),function(a){"use strict";var b,c=window.CDS,d={};d.decode=function(a){var c;if(void 0===b){var d="= \f\n\r\t \u2028\u2029";for(b=[],c=0;c<64;++c)b["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(c)]=c;for(c=0;c<d.length;++c)b[d.charAt(c)]=-1}var e=[],f=0,g=0;for(c=0;c<a.length;++c){var h=a.charAt(c);if("="==h)break;if(-1!=(h=b[h])){if(void 0===h)throw"Illegal character at offset "+c;f|=h,++g>=4?(e[e.length]=f>>16,e[e.length]=f>>8&255,e[e.length]=255&f,f=0,g=0):f<<=6}}switch(g){case 1:throw"Base64 encoding incomplete: at least 2 bits missing";case 2:e[e.length]=f>>10;break;case 3:e[e.length]=f>>16,e[e.length]=f>>8&255}return e},d.re=/-----BEGIN [^-]+-----([A-Za-z0-9+\/=\s]+)-----END [^-]+-----|begin-base64[^\n]+\n([A-Za-z0-9+\/=\s]+)====/,d.unarmor=function(a){var b=d.re.exec(a);if(b)if(b[1])a=b[1];else{if(!b[2])throw"RegExp out of sync";a=b[2]}return d.decode(a)},c.cdsProcess.Base64=d}(),function(){"use strict";function a(a){this.buf=[+a||0]}var b=window.CDS;a.prototype.mulAdd=function(a,b){var c,d,e=this.buf,f=e.length;for(c=0;c<f;++c)d=e[c]*a+b,d<1e13?b=0:(b=0|d/1e13,d-=1e13*b),e[c]=d;b>0&&(e[c]=b)},a.prototype.toString=function(a){if(10!=(a||10))throw"only base 10 is supported";for(var b=this.buf,c=b[b.length-1].toString(),d=b.length-2;d>=0;--d)c+=(1e13+b[d]).toString().substring(1);return c},a.prototype.valueOf=function(){for(var a=this.buf,b=0,c=a.length-1;c>=0;--c)b=1e13*b+a[c];return b},a.prototype.simplify=function(){var a=this.buf;return 1==a.length?a[0]:this},b.cdsProcess.Int10=a}(),function(a){"use strict";function b(a,b){return a.length>b&&(a=a.substring(0,b)+h),a}function c(a,b){a instanceof c?(this.enc=a.enc,this.pos=a.pos):(this.enc=a,this.pos=b)}function d(a){var b=a.get();if(this.tagClass=b>>6,this.tagConstructed=0!=(32&b),this.tagNumber=31&b,31==this.tagNumber){var c=new g;do{b=a.get(),c.mulAdd(128,127&b)}while(128&b);this.tagNumber=c.simplify()}}function e(a,b,c,e,f){if(!(e instanceof d))throw"Invalid tag value.";this.stream=a,this.header=b,this.length=c,this.tag=e,this.sub=f}var f=window.CDS,g=f.cdsProcess.Int10,h="…",i=/^(\d\d)(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])([01]\d|2[0-3])(?:([0-5]\d)(?:([0-5]\d)(?:[.,](\d{1,3}))?)?)?(Z|[-+](?:[0]\d|1[0-2])([0-5]\d)?)?$/,j=/^(\d\d\d\d)(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])([01]\d|2[0-3])(?:([0-5]\d)(?:([0-5]\d)(?:[.,](\d{1,3}))?)?)?(Z|[-+](?:[0]\d|1[0-2])([0-5]\d)?)?$/;c.prototype.get=function(a){if(void 0===a&&(a=this.pos++),a>=this.enc.length)throw"Requesting byte offset "+a+" on a stream of length "+this.enc.length;return"string"==typeof this.enc?this.enc.charCodeAt(a):this.enc[a]},c.prototype.hexDigits="0123456789ABCDEF",c.prototype.hexByte=function(a){return this.hexDigits.charAt(a>>4&15)+this.hexDigits.charAt(15&a)},c.prototype.hexDump=function(a,b,c){for(var d="",e=a;e<b;++e)if(d+=this.hexByte(this.get(e)),!0!==c)switch(15&e){case 7:d+="  ";break;case 15:d+="\n";break;default:d+=" "}return d},c.prototype.isASCII=function(a,b){for(var c=a;c<b;++c){var d=this.get(c);if(d<32||d>176)return!1}return!0},c.prototype.parseStringISO=function(a,b){for(var c="",d=a;d<b;++d)c+=String.fromCharCode(this.get(d));return c},c.prototype.parseStringUTF=function(a,b){for(var c="",d=a;d<b;){var e=this.get(d++);c+=e<128?String.fromCharCode(e):e>191&&e<224?String.fromCharCode((31&e)<<6|63&this.get(d++)):String.fromCharCode((15&e)<<12|(63&this.get(d++))<<6|63&this.get(d++))}return c},c.prototype.parseStringBMP=function(a,b){for(var c,d,e="",f=a;f<b;)c=this.get(f++),d=this.get(f++),e+=String.fromCharCode(c<<8|d);return e},c.prototype.parseTime=function(a,b,c){var d=this.parseStringISO(a,b),e=(c?i:j).exec(d);return e?(c&&(e[1]=+e[1],e[1]+=e[1]<70?2e3:1900),d=e[1]+"-"+e[2]+"-"+e[3]+" "+e[4],e[5]&&(d+=":"+e[5],e[6]&&(d+=":"+e[6],e[7]&&(d+="."+e[7]))),e[8]&&(d+=" UTC","Z"!=e[8]&&(d+=e[8],e[9]&&(d+=":"+e[9]))),d):"Unrecognized time: "+d},c.prototype.parseInteger=function(a,b){for(var c,d=this.get(a),e=d>127,f=e?255:0,h="";d==f&&++a<b;)d=this.get(a);if(0===(c=b-a))return e?-1:0;if(c>4){for(h=d,c<<=3;0==(128&(h^f));)h<<=1,--c;h="("+c+" bit)\n"}e&&(d-=256);for(var i=new g(d),j=a+1;j<b;++j)i.mulAdd(256,this.get(j));return h+i.toString()},c.prototype.parseBitString=function(a,c,d){for(var e=this.get(a),f=(c-a-1<<3)-e,g="("+f+" bit)\n",h="",i=a+1;i<c;++i){for(var j=this.get(i),k=i==c-1?e:0,l=7;l>=k;--l)h+=j>>l&1?"1":"0";if(h.length>d)return g+b(h,d)}return g+h},c.prototype.parseOctetString=function(a,c,d){if(this.isASCII(a,c))return b(this.parseStringISO(a,c),d);var e=c-a,f="("+e+" byte)\n";d/=2,e>d&&(c=a+d);for(var g=a;g<c;++g)f+=this.hexByte(this.get(g));return e>d&&(f+=h),f},c.prototype.parseOID=function(a,c,d){for(var e="",f=new g,h=0,i=a;i<c;++i){var j=this.get(i);if(f.mulAdd(128,127&j),h+=7,!(128&j)){if(""===e){f=f.simplify();var k=f<80?f<40?0:1:2;e=k+"."+(f-40*k)}else e+="."+f.toString();if(e.length>d)return b(e,d);f=new g,h=0}}return h>0&&(e+=".incomplete"),e},e.prototype.typeName=function(){switch(this.tag.tagClass){case 0:switch(this.tag.tagNumber){case 0:return"EOC";case 1:return"BOOLEAN";case 2:return"INTEGER";case 3:return"BIT_STRING";case 4:return"OCTET_STRING";case 5:return"NULL";case 6:return"OBJECT_IDENTIFIER";case 7:return"ObjectDescriptor";case 8:return"EXTERNAL";case 9:return"REAL";case 10:return"ENUMERATED";case 11:return"EMBEDDED_PDV";case 12:return"UTF8String";case 16:return"SEQUENCE";case 17:return"SET";case 18:return"NumericString";case 19:return"PrintableString";case 20:return"TeletexString";case 21:return"VideotexString";case 22:return"IA5String";case 23:return"UTCTime";case 24:return"GeneralizedTime";case 25:return"GraphicString";case 26:return"VisibleString";case 27:return"GeneralString";case 28:return"UniversalString";case 30:return"BMPString"}return"Universal_"+this.tag.tagNumber.toString();case 1:return"Application_"+this.tag.tagNumber.toString();case 2:return"["+this.tag.tagNumber.toString()+"]";case 3:return"Private_"+this.tag.tagNumber.toString()}},e.prototype.content=function(a){if(void 0===this.tag)return null;void 0===a&&(a=1/0);var c=this.posContent(),d=Math.abs(this.length);if(!this.tag.isUniversal())return null!==this.sub?"("+this.sub.length+" elem)":this.stream.parseOctetString(c,c+d,a);switch(this.tag.tagNumber){case 1:return 0===this.stream.get(c)?"false":"true";case 2:return this.stream.parseInteger(c,c+d);case 3:return this.sub?"("+this.sub.length+" elem)":this.stream.parseBitString(c,c+d,a);case 4:return this.sub?"("+this.sub.length+" elem)":this.stream.parseOctetString(c,c+d,a);case 6:return this.stream.parseOID(c,c+d,a);case 16:case 17:return null!==this.sub?"("+this.sub.length+" elem)":"(no elem)";case 12:return b(this.stream.parseStringUTF(c,c+d),a);case 18:case 19:case 20:case 21:case 22:case 26:return b(this.stream.parseStringISO(c,c+d),a);case 30:return b(this.stream.parseStringBMP(c,c+d),a);case 23:case 24:return this.stream.parseTime(c,c+d,23==this.tag.tagNumber)}return null},e.prototype.toString=function(){return this.typeName()+"@"+this.stream.pos+"[header:"+this.header+",length:"+this.length+",sub:"+(null===this.sub?"null":this.sub.length)+"]"},e.prototype.toPrettyString=function(a){void 0===a&&(a="");var b=a+this.typeName()+" @"+this.stream.pos;if(this.length>=0&&(b+="+"),b+=this.length,this.tag.tagConstructed?b+=" (constructed)":!this.tag.isUniversal()||3!=this.tag.tagNumber&&4!=this.tag.tagNumber||null===this.sub||(b+=" (encapsulates)"),b+="\n",null!==this.sub){a+="  ";for(var c=0,d=this.sub.length;c<d;++c)b+=this.sub[c].toPrettyString(a)}return b},e.prototype.posStart=function(){return this.stream.pos},e.prototype.posContent=function(){return this.stream.pos+this.header},e.prototype.posEnd=function(){return this.stream.pos+this.header+Math.abs(this.length)},e.prototype.toHexString=function(a){return this.stream.hexDump(this.posStart(),this.posEnd(),!0)},e.decodeLength=function(a){var b=a.get(),c=127&b;if(c==b)return c;if(c>6)throw"Length over 48 bits not supported at position "+(a.pos-1);if(0===c)return null;b=0;for(var d=0;d<c;++d)b=256*b+a.get();return b},d.prototype.isUniversal=function(){return 0===this.tagClass},d.prototype.isEOC=function(){return 0===this.tagClass&&0===this.tagNumber},e.decode=function(a){a instanceof c||(a=new c(a,0));var b=new c(a),f=new d(a),g=e.decodeLength(a),h=a.pos,i=h-b.pos,j=null,k=function(){if(j=[],null!==g){for(var b=h+g;a.pos<b;)j[j.length]=e.decode(a);if(a.pos!=b)throw"Content size is not correct for container starting at offset "+h}else try{for(;;){var c=e.decode(a);if(c.tag.isEOC())break;j[j.length]=c}g=h-a.pos}catch(a){throw"Exception while decoding undefined length content: "+a}};if(f.tagConstructed)k();else if(f.isUniversal()&&(3==f.tagNumber||4==f.tagNumber))try{if(3==f.tagNumber&&0!=a.get())throw"BIT STRINGs with unused bits cannot encapsulate.";k();for(var l=0;l<j.length;++l)if(j[l].tag.isEOC())throw"EOC is not supposed to be actual content."}catch(a){j=null}if(null===j){if(null===g)throw"We can't skip over an invalid tag with undefined length at offset "+h;a.pos=h+Math.abs(g)}return new e(b,i,g,f,j)},f.cdsProcess.ASN1=e}(),function(){"use strict";function a(){this.i=0,this.j=0,this.S=[]}function b(a){var b,c,d;for(b=0;b<256;++b)this.S[b]=b;for(c=0,b=0;b<256;++b)c=c+this.S[b]+a[b%a.length]&255,d=this.S[b],this.S[b]=this.S[c],this.S[c]=d;this.i=0,this.j=0}function c(){var a;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,a=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=a,this.S[a+this.S[this.i]&255]}function d(){return new a}function e(){if(null==p){for(p=d();r<s;){var a=Math.floor(65536*Math.random());q[r++]=255&a}for(p.init(q),r=0;r<q.length;++r)q[r]=0;r=0}return p.next()}function f(a){var b;for(b=0;b<a.length;++b)a[b]=e()}function g(){}function h(a,b){return new t(a,b)}function i(a,b){if(b<a.length+11)return console.error("Message too long for RSA"),null;for(var c=[],d=a.length-1;d>=0&&b>0;){var e=a.charCodeAt(d--);e<128?c[--b]=e:e>127&&e<2048?(c[--b]=63&e|128,c[--b]=e>>6|192):(c[--b]=63&e|128,c[--b]=e>>6&63|128,c[--b]=e>>12|224)}c[--b]=0;for(var f=new g,h=[];b>2;){for(h[0]=0;0==h[0];)f.nextBytes(h);c[--b]=h[0]}return c[--b]=2,c[--b]=0,new t(c)}function j(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function k(a,b){null!=a&&null!=b&&a.length>0&&b.length>0?(this.n=h(a,16),this.e=parseInt(b,16)):console.error("Invalid RSA public key")}function l(a){return a.modPowInt(this.e,this.n)}function m(a){var b=i(a,this.n.bitLength()+7>>3);if(null==b)return null;var c=this.doPublic(b);if(null==c)return null;var d=c.toString(16);return 0==(1&d.length)?d:"0"+d}function n(a){var b=/^\s*(?:[0-9A-Fa-f][0-9A-Fa-f]\s*)+$/;try{return b.test(a)?o.cdsProcess.Hex.decode(a):o.cdsProcess.Base64.re.test(a)?o.cdsProcess.Base64.unarmor(a):a}catch(a){console.log("Exception occurred while decoding binary string")}}var o=window.CDS;a.prototype.init=b,a.prototype.next=c;var p,q,r,s=256;if(null==q){q=[],r=0}g.prototype.nextBytes=f;var t=o.cdsProcess.BigInteger;j.prototype.doPublic=l,j.prototype.setPublic=k,j.prototype.encrypt=m,j.prototype.parseBigInt=h,o.cdsProcess.ASN1.prototype.getHexStringValue=function(){var a=this.toHexString(),b=2*this.header,c=2*this.length;return a.substr(b,c)},j.prototype.parseKey=function(a){try{var b=0,c=0,d=n(a),e=o.cdsProcess.ASN1.decode(d);if(2!==e.sub.length)return!1;var f=e;return e.sub[1]&&null!=e.sub[1].sub&&void 0!=e.sub[1].sub&&(f=e.sub[1].sub[0]),b=f.sub[0].getHexStringValue(),this.n=h(b,16),c=f.sub[1].getHexStringValue(),this.e=parseInt(c,16),!0}catch(a){return!1}},j.prototype.getPublicBaseKey=function(){var a={array:[new KJUR.asn1.DERObjectIdentifier({oid:"1.2.840.113549.1.1.1"}),new KJUR.asn1.DERNull]},b=new KJUR.asn1.DERSequence(a);return a={array:[new KJUR.asn1.DERInteger({bigint:this.n}),new KJUR.asn1.DERInteger({int:this.e})]},a={hex:"00"+new KJUR.asn1.DERSequence(a).getEncodedHex()},a={array:[b,new KJUR.asn1.DERBitString(a)]},new KJUR.asn1.DERSequence(a).getEncodedHex()},j.prototype.getPublicBaseKeyB64=function(){return hex2b64(this.getPublicBaseKey())},j.prototype.wordwrap=function(a,b){if(b=b||64,!a)return a;var c="(.{1,"+b+"})( +|$\n?)|(.{1,"+b+"})";return a.match(RegExp(c,"g")).join("\n")},j.prototype.getPublicKey=function(){var a="-----BEGIN PUBLIC KEY-----\n";return a+=this.wordwrap(this.getPublicBaseKeyB64())+"\n",a+="-----END PUBLIC KEY-----"},j.prototype.hasPublicKeyProperty=function(a){return a=a||{},a.hasOwnProperty("n")&&a.hasOwnProperty("e")},j.prototype.parsePropertiesFrom=function(a){this.n=a.n,this.e=a.e,a.hasOwnProperty("d")&&(this.d=a.d,this.p=a.p,this.q=a.q,this.dmp1=a.dmp1,this.dmq1=a.dmq1,this.coeff=a.coeff)};var u=function(a){j.call(this),a&&("string"==typeof a?this.parseKey(a):this.hasPublicKeyProperty(a)&&this.parsePropertiesFrom(a))};u.prototype=new j,u.prototype.constructor=u;var v=function(a){a=a||{},this.default_key_size=parseInt(a.default_key_size)||1024,this.default_public_exponent=a.default_public_exponent||"010001",this.log=a.log||!1,this.key=null};v.prototype.setKey=function(a){this.log&&this.key&&console.warn("A key was already set, overriding existing."),this.key=new u(a)},v.prototype.setPublicKey=function(a){this.setKey(a)},v.prototype.encrypt=function(a){try{return hex2b64(this.getKey().encrypt(a))}catch(a){return!1}},v.prototype.encryptToHex=function(a){try{return this.getKey().encrypt(a)}catch(a){return!1}},v.prototype.getKey=function(){if(!this.key)throw"key does not exist";return this.key},v.prototype.getPublicKey=function(){return this.getKey().getPublicKey()},v.prototype.getPublicKeyB64=function(){return this.getKey().getPublicBaseKeyB64()},o.JSEncrypt=v}.call(this);